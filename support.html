<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Support System</title>
    <link rel="stylesheet" href="./styles.css" />
    <style>
      .valid {
        color: green;
      }
      .invalid {
        color: red;
        align-self: start;
      }
      .message {
        padding: 0%;
        display: none;
        font-size: small;
        margin: -20px 0 0;
        align-self: flex-start;
      }
    </style>
  </head>
  <body>
    <section class="support-container">
      <h1>Contact Support</h1>
      <form action="/submit_support_request" method="post">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required />
        <div id="nameMessage" class="message">
          <p id="nameLength" class="invalid">Minimum 4 characters</p>
        </div>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required />
        <div id="emailMessage" class="message">
          <p id="emailFormat" class="invalid">Valid email format</p>
        </div>

        <label for="subject">Subject:</label>
        <input type="text" id="subject" name="subject" required />
        <div id="subjectMessage" class="message">
          <p id="subjectLength" class="invalid">Minimum 5 characters</p>
        </div>

        <label for="message">Message:</label>
        <textarea id="message" name="message" rows="5" required></textarea>
        <div id="textMessage" class="message">
          <p id="messageLength" class="invalid">Minimum 100 characters</p>
        </div>

        <button type="submit">Submit</button>
      </form>
    </section>

    <script>
      // Strict mode for better code quality
        "use strict";

      // Function to add validation to input fields
      function addValidation(inputId, messageId, validations) {
        const input = document.getElementById(inputId);
        const message = document.getElementById(messageId);

        // Event listeners for input field
        input.addEventListener("blur", function () {
          validateInput(input, message, validations);
        });

        input.addEventListener("input", function () {
          clearTimeout(input.timeout);
          input.timeout = setTimeout(function () {
            validateInput(input, message, validations);
          }, 500);
        });
      }

      // Function to validate input
      function validateInput(input, message, validations) {
        let isValid = true;
        validations.forEach((validation) => {
          const { regex, elementId, validClass, invalidClass } = validation;
          const element = document.getElementById(elementId);
          if (!regex.test(input.value)) {
            element.classList.remove(validClass);
            element.classList.add(invalidClass);
            isValid = false;
          } else {
            element.classList.remove(invalidClass);
            element.classList.add(validClass);
          }
        });

        if (isValid) {
          message.style.display = "none";
        } else {
          message.style.display = "block";
        }
      }

      // Name field validations
      addValidation("name", "nameMessage", [
        {
          regex: /.{4,}/,
          elementId: "nameLength",
          validClass: "valid",
          invalidClass: "invalid",
        },
      ]);

      // Email field validations
      addValidation("email", "emailMessage", [
        {
          regex: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
          elementId: "emailFormat",
          validClass: "valid",
          invalidClass: "invalid",
        },
      ]);

      // Subject field validations
      addValidation("subject", "subjectMessage", [
        {
          regex: /.{5,}/,
          elementId: "subjectLength",
          validClass: "valid",
          invalidClass: "invalid",
        },
      ]);

      // Message field validations
      addValidation("message", "textMessage", [
        {
          regex: /.{100,}/,
          elementId: "messageLength",
          validClass: "valid",
          invalidClass: "invalid",
        },
      ]);
    </script>
  </body>
</html>
